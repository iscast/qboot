<!-- 表单弹窗 -->
<form id="operateinfo-form" lay-filter="operateinfo-form" class="layui-form model-form">
        <input id="logId" name="logId" type="hidden"/>
        <input id="physicsFlag" name="physicsFlag" type="hidden"/>
        <div class="layui-form-item">
            <label class="layui-form-label layui-i18n" i18n-key="sys.table.title.uriName"></label>
            <div class="layui-input-block">
                <input id="uriName" name="uriName" i18n-key="sys.form.label.inputUriName" type="text" class="layui-input i18n-input-hint" maxlength="200"
                       lay-verify="required" required/>
            </div>
        </div>
		<div class="layui-form-item">
        <label class="layui-form-label layui-i18n" i18n-key="sys.table.title.uriAddr"></label>
        	<div class="layui-input-block">
	            <input id="reqUri" name="reqUri" i18n-key="sys.form.label.inputUriAddr" type="text" class="layui-input i18n-input-hint" maxlength="200"
                       lay-verify="required" required/>
        	</div>
    	</div>
		<div class="layui-form-item">
        <label class="layui-form-label layui-i18n" i18n-key="sys.table.title.uriType"></label>
        	<div class="layui-input-block">
	            <select id="uriType" name="uriType" lay-filter="uriType" lay-verify="required">
	            	<option value="">--URI类型--</option>
	            </select>
        	</div>
    	</div>
        <div class="layui-form-item">
            <label class="layui-form-label layui-i18n" i18n-key="sys.form.label.remark"></label>
            <div class="layui-input-block">
                <textarea id="remarks" name="remarks" placeholder="请输入内容" class="layui-textarea" maxlength="2000"></textarea>
            </div>
        </div>
        <div class="layui-form-item model-form-footer">
            <button class="layui-btn layui-btn-primary layui-btn-cancel" ew-event="closeDialog" type="button"></button>
            <button class="layui-btn layui-btn-save" lay-filter="operateinfo-form-submit" lay-submit></button>
        </div> 
</form>

<script>
    layui.use(['layer', 'admin', 'form', 'formSelects', 'table', '_config', 'authtree','_i18n'], function () {
        var layer = layui.layer;
        var admin = layui.admin;
        var form = layui.form;
        var _config = layui._config;
        var formSelects = layui.formSelects;
        var table = layui.table;
    	var authtree = layui.authtree;
        var _i18n = layui._i18n;
        var msgs = _i18n.getMsg('sys') ;

        form.render('radio');

        layer.load(2);
        
     // 回显operateinfo数据
        var operateinfo = admin.getTempData('t_operateinfo');
        $('#operateinfo-form').attr('method', 'POST');
        _i18n.initPage();
        if (operateinfo) {
            form.val('operateinfo-form', operateinfo);
        }


        // 表单提交事件
        form.on('submit(operateinfo-form-submit)', function (data) {
            layer.load(2);
            var logId = $('#logId').val();
            var url = '/sys/operateinfo/save';
            if(logId != null && logId != ''){
            	url = '/sys/operateinfo/update';
            }

            admin.req(url, data.field, function (data) {
                layer.closeAll('loading');
                if (data.code == 0) {
                    layer.msg(data.msg, {icon: 1});
                    table.reload('operateLogInfo-table');
                    layer.closeAll('page');
                } else {
                    layer.msg(data.msg, {icon: 2});
                }
            }, 'post');
            return false;
        });
        
      //获取部门
        layer.load(2);
        admin.req('/sys/paramtype/getParamType', {paramType:'URI_TYPE'}, function (data) {
            layer.closeAll('loading');
            if (0 == data.code) {
                // 渲染多选下拉框
                for (var i = 0; i < data.data.length; i++) {
                    $("#uriType").append("<option value="+data.data[i].paramTypeId+">"+data.data[i].paramTypeName+"</option>"); 
                }
                
                // 回显user数据
                var user = admin.getTempData('t_operateinfo');
                $('#operateinfo-form').attr('method', 'POST');
                if (user) {
                    form.val('operateinfo-form', user);
                }
                form.render();//表单重新渲染，要不然添加完显示不出来新的option
            } else {
                layer.msg('获取uri类型失败', {icon: 2});
            }
        }, 'GET');
        
        layer.closeAll('loading');
    });
    
</script>